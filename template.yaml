id: CVE-2024-39929

info:
  name: CVE-2024-39929
  author: rxerium
  severity: critical
  description: |
    Exim through 4.97.1 misparses a multiline RFC 2231 header filename, and thus remote attackers can bypass a $mime_filename extension-blocking protection mechanism, and potentially deliver executable attachments to the mailboxes of end users.
  reference:
    - https://thehackernews.com/2024/07/critical-exim-mail-server-vulnerability.html
    - https://nvd.nist.gov/vuln/detail/CVE-2024-39929
  tags: exim,mail,CVE-2024-39929
tcp:
  - inputs:
      - data: "\n"

    host:
      - "{{Hostname}}"
    port: 465,587

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "ESMTP Exim"

      - type: word
        words:
          - "4.97.1"
          - "4.97"
          - "4.96"
          - "4.95"
          - "4.94"
          - "4.93"
          - "4.92"
          - "4.91"
          - "4.90"
          - "4.89"
          - "4.88"
          - "4.87"
          - "4.86"
          - "4.85"
          - "4.84"
          - "4.83"
          - "4.82"
          - "4.81"
          - "4.80"
          - "4.79"
          - "4.78"
          - "4.77"
          - "4.76"
          - "4.75"
          - "4.74"
          - "4.73"
          - "4.72"
          - "4.71"
          - "4.70"
          - "4.69"
          - "4.68"
          - "4.67"
          - "4.66"
          - "4.65"
          - "4.64"
          - "4.63"
          - "4.62"
          - "4.61"
          - "4.50"
          - "4.40"
          - "4.30"
          - "4.20"
          - "4.10"
          - "4.00"
          - "3.30"
          - "3.20"
          - "3.10"
          - "3.00"
          - "2.10"
          - "2.00"
          - "1.90"
        part: version

    extractors:
      - type: regex
        group: 1
        regex:
          - '(?i)SMTP.Exim\s?([\w.]+)'